<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>产后恢复</title>
  <style>
    :root{--brand:#2B77F2;--bg:#f7f8fa;--text:#1a1a1a;--muted:#667085;--card:#fff}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
    .header{background:var(--card);padding:16px 24px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between}
    .header-left{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;background:linear-gradient(135deg,#20b2aa,#17a2b8);border-radius:8px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:20px;font-weight:bold}
    .header-titles{}
    .header-title{font-size:18px;font-weight:bold;color:var(--text);margin:0}
    .header-subtitle{font-size:13px;color:var(--muted);margin:0}
    .header-lang{display:flex;align-items:center;gap:8px;font-size:14px}
    .lang-select{border:1px solid #e5e7eb;border-radius:8px;padding:6px 12px;background:var(--card);cursor:pointer;display:flex;align-items:center;gap:8px}
    .wrap{max-width:820px;margin:0 auto;padding:24px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,.06);padding:20px;margin-bottom:16px}
    h1{font-size:24px;margin:8px 0 16px}
    .title{display:flex;gap:12px;align-items:center}
    .progress{height:8px;background:#e5e7eb;border-radius:6px;overflow:hidden;margin:8px 0 16px}
    .progress>div{height:100%;background:var(--brand);width:0%}
    .q{margin:12px 0 8px;font-weight:600}
    .opts{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:8px 0 16px}
    .opt{border:1px solid #e5e7eb;border-radius:12px;padding:10px 12px;cursor:pointer;user-select:none}
    .opt input{margin-right:8px}
    .actions{display:flex;gap:10px;justify-content:space-between;margin-top:8px}
    button{border:0;border-radius:12px;padding:10px 16px;cursor:pointer;background:var(--brand);color:#fff;font-weight:600}
    button.ghost{background:#eef2ff;color:#1f2a44}
    .muted{color:var(--muted);font-size:12px}
    .qrbox{display:flex;gap:16px;align-items:center;padding:12px;border:1px dashed #cbd5e1;border-radius:12px;background:#f8fafc}
    .result h2{margin:8px 0 12px}
    .pill{background:#eef2ff;border-radius:999px;padding:6px 10px;font-weight:600}
    .dim-scores{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:12px 0}
    .print{position:fixed;right:16px;bottom:16px;background:#111827;color:#fff;border:0;border-radius:999px;padding:12px 16px;cursor:pointer}
    .footer{text-align:center;padding:24px;color:var(--muted);font-size:13px}
    .hidden{display:none}
    @media print{.print,.actions,.progress,.header,.footer{display:none!important}body{background:#fff}.card{box-shadow:none;border:1px solid #eee}}
  </style>
</head>
<body>
  <!-- 头部 -->
  <div class="header">
    <div class="header-left">
      <div class="logo">健</div>
      <div class="header-titles">
        <div class="header-title">小林健康研究所</div>
        <div class="header-subtitle">产后恢复专业评估（Pro）</div>
      </div>
    </div>
    <div class="header-lang">
      <span>语言:</span>
      <div class="lang-select">
        <span id="currentLang">简体中文</span>
        <span>▼</span>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="title"><h1 id="surveyTitle">产后恢复</h1></div>
      <div class="progress"><div id="bar"></div></div>
      <div id="step"></div>
      <div class="actions">
        <button class="ghost" id="prevBtn">上一步</button>
        <button id="nextBtn">下一步</button>
      </div>
      <div class="muted" id="footnote"></div>
    </div>

    <div class="card result hidden" id="resultCard">
      <h2>评估结果</h2>
      <div id="severity" class="pill"></div>
      <div class="dim-scores" id="dimScores"></div>
      <div id="conclusions"></div>
      <div id="reco"></div>

      <h3>到店/联系店铺</h3>
      <div class="qrbox">
        <div id="qrcode"></div>
        <div>
          <div>请使用微信/相机扫码</div>
          <div class="muted" id="qrHint"></div>
        </div>
      </div>
    </div>
  </div>

  <button class="print" onclick="window.print()">打印/保存PDF</button>

  <!-- 模板数据 -->
  <script type="application/json" id="TEMPLATE">{"Q":[{"key":"sleep","title":{"zh":"睡眠质量（EN）","en":"Sleep quality (EN)","ja":"睡眠（EN）"},"type":"single","opts":[["poor","差/易醒"],["mid","一般"],["good","良好"]],"templateId":"tpl_1761544843302","templateName":"模板_tpl_1761544843302"},{"key":"time","title":{"zh":"产后时间（REC）","en":"Postpartum time (REC)","ja":"産後期間（REC）"},"type":"single","opts":[["lt2","<2 周"],["w2_6","2–6 周"],["gt6","> 6 周"]],"templateId":"tpl_1761544843302","templateName":"模板_tpl_1761544843302"},{"key":"pain","title":{"zh":"疼痛评分 NRS（PAIN）","en":"Pain NRS (PAIN)","ja":"疼痛 NRS（PAIN）"},"type":"single","opts":[["sev","重度（7–10）"],["mid","中度（4–6）"],["mild","轻度（0–3）"]],"templateId":"tpl_1761544843302","templateName":"模板_tpl_1761544843302"},{"key":"energy","title":{"zh":"白天体力（EN）","en":"Daytime energy (EN)","ja":"体力（EN）"},"type":"single","opts":[["bad","很差"],["low","偏低"],["good","良好"]],"templateId":"tpl_1761544843302","templateName":"模板_tpl_1761544843302"},{"key":"lacto","title":{"zh":"乳房与哺乳（可多选，LAC）","en":"Breastfeeding (multi, LAC)","ja":"授乳（複数・LAC）"},"type":"multi","opts":[["eng","胀痛/堵奶"],["mast","局部红热伴痛"],["none","均无"]],"templateId":"tpl_1761544843302","templateName":"模板_tpl_1761544843302"}],"WT":{"REC":{"bleed":{"heavy":4,"decr":1,"stop":0},"lochia":{"abn":3,"gt6w":3,"ok":0},"temp":{"fev38":4,"lowfev":2,"nofev":0},"incision":{"red":3,"exu":4,"ok":0}},"PF":{"pf":{"ui":3,"pro":3,"none":0}},"LAC":{"lacto":{"eng":2,"mast":4,"none":0}},"MOOD":{"mood":{"sev":4,"mild":2,"ok":0}},"EN":{"sleep":{"poor":2,"mid":1,"good":0},"energy":{"bad":2,"low":1,"good":0},"act":{"sed":1,"light":0.5,"mod":0},"diet":{"protlow":1,"irreg":0,"bal":0}},"GUT":{"bowel":{"const":2,"hemo":1,"none":0},"diet":{"protlow":1,"irreg":1,"bal":0}},"PAIN":{"pain":{"sev":3,"mid":2,"mild":0}}},"UI":{"zh":{"subA":"产后恢复专业评估（Pro）","prev":"上一步","next":"下一步","submit":"提交","lead":"留下联系方式以生成个性化产后评估","yourPlan":"产后恢复评估报告","overview":"总体概述","dims":"分维度分析","actions":"重点干预清单","follow":"复诊/随访时间窗","buy":"立即购买","copy":"复制推荐文案","ok":"已复制","fail":"复制失败","needQ":"请先选择本题答案","needLead":"请填写姓名与联系方式","sev":{"a":"Ⅰ 良好","b":"Ⅱ 需关注","c":"Ⅲ 需干预","d":"Ⅳ 高风险"},"dim":{"REC":"恢复","PF":"盆底","LAC":"泌乳","MOOD":"情绪","EN":"体力/睡眠","GUT":"排便/营养","PAIN":"疼痛"},"med":"当前存在就医红旗，建议尽快前往产科/乳腺/外科等门诊评估。（本自测不替代医疗服务）","rec":"优先处理主导问题，再进入巩固/维持期"},"en":{"subA":"Postpartum Recovery Assessment (Pro)","prev":"Back","next":"Next","submit":"Submit","lead":"Leave your contact to generate your report","yourPlan":"Postpartum Recovery Report","overview":"Overview","dims":"Dimension Analysis","actions":"Priority Interventions","follow":"Follow-up Window","buy":"Buy Now","copy":"Copy Summary","ok":"Copied","fail":"Copy failed","needQ":"Please answer this question first","needLead":"Please fill your name & contact","sev":{"a":"I Good","b":"II Watch","c":"III Intervene","d":"IV High-risk"},"dim":{"REC":"Recovery","PF":"Pelvic floor","LAC":"Lactation","MOOD":"Mood","EN":"Energy/Sleep","GUT":"Bowel/Nutrition","PAIN":"Pain"},"med":"Red flags present. Please seek in-person care. This tool does not replace medical services.","rec":"Prioritize leading problems, then enter consolidation/maintenance."},"ja":{"subA":"産後リカバリー評価（Pro）","prev":"戻る","next":"次へ","submit":"送信","lead":"連絡先を入力してレポートを生成","yourPlan":"産後リカバリーレポート","overview":"総合概要","dims":"領域分析","actions":"重点介入","follow":"再診/フォロー時期","buy":"今すぐ購入","copy":"推奨文をコピー","ok":"コピー済み","fail":"コピー失敗","needQ":"この設問に回答してください","needLead":"氏名と連絡先を入力してください","sev":{"a":"Ⅰ 良好","b":"Ⅱ 注視","c":"Ⅲ 介入要","d":"Ⅳ ハイリスク"},"dim":{"REC":"回復","PF":"骨盤底","LAC":"授乳","MOOD":"気分","EN":"体力/睡眠","GUT":"排便/栄養","PAIN":"疼痛"},"med":"レッドフラッグあり。速やかに受診してください。本ツールは医療行為を代替しません。","rec":"主導課題を優先し、その後維持期へ。"}},"meta":{"title":"产后恢复","name":"产后恢复","lang_default":"zh"},"rules":{"conclusions":[{"if":{"any":[{"dim":{"REC":">= 3"}},{"dim":{"MOOD":">= 2"}},{"dim":{"GUT":">= 2"}}]},"text":{"zh":"根据您的问卷结果，建议关注产后恢复情况，必要时咨询专业医生。","en":"Based on your survey results, we recommend paying attention to your postpartum recovery and consulting a professional if needed.","ja":"質問票の結果に基づき、産後リカバリー状況に注意を払い、必要に応じて専門医に相談することをお勧めします。"}}],"recommendations":[{"if":{"dim":{"REC":">= 2"}},"product":{"code":"rec_001","title":{"zh":"产后康复指导","en":"Postpartum Recovery Guidance","ja":"産後リカバリーガイダンス"}}},{"if":{"dim":{"GUT":">= 1"}},"product":{"code":"gut_001","title":{"zh":"肠道健康调理套餐","en":"Gut Health Package","ja":"腸内健康パッケージ"}}}]},"products":[{"id":"rec_001","name":"产后康复指导","desc":"专业产后恢复指导服务，包括饮食、运动、康复训练等全方位建议","images":[],"price":0,"category":"产后康复"},{"id":"gut_001","name":"肠道健康调理套餐","desc":"针对产后便秘、肠道不适的专业调理方案，包括膳食建议和营养补充","images":[],"price":0,"category":"肠道健康"}]}</script>

  <!-- 超轻量 qrcode.js -->
  <script>
  !function(){function n(n){this.mode=4,this.data=n}function t(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function e(n,t){this.totalCount=n,this.dataCount=t}function r(){this.buffer=[],this.length=0}var o={};n.prototype={getLength:function(){return this.data.length},write:function(n){for(var t=0;t<this.data.length;t++)n.put(this.data.charCodeAt(t),8)}},t.prototype={addData:function(t){this.dataList.push(new n(t)),this.dataCache=null},isDark:function(n,t){if(n<0||this.moduleCount<=n||t<0||this.moduleCount<=t)throw new Error(n+","+t);return this.modules[n][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(n,e){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++)this.modules[r][o]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupTimingPattern(),this.setupTypeInfo(n,e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)},setupPositionProbePattern:function(n,t){for(var e=-1;e<=7;e++)if(!(n+e<=-1||this.moduleCount<=n+e))for(var r=-1;r<=7;r++)t+r<=-1||this.moduleCount<=t+r||(this.modules[n+e][t+r]=e>=0&&e<=6&&(0==r||6==r)||r>=0&&r<=6&&(0==e||6==e)||e>=2&&e<=4&&r>=2&&r<=4)},getBestMaskPattern:function(){for(var n=0,e=0,r=0;r<8;r++){this.makeImpl(!0,r);var o=i.getLostPoint(this);(0==r||n>o)&&(n=o,e=r)}return e},setupTimingPattern:function(){for(var n=8;n<this.moduleCount-8;n++)null==this.modules[n][6]&&(this.modules[n][6]=n%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=t%2==0)},setupTypeInfo:function(n,t){for(var e=0;e<15;e++){var r=!n&&1==(u>>e&1);e<6?this.modules[e][8]=r:e<8?this.modules[e+1][8]=r:this.modules[this.moduleCount-15+e][8]=r}for(e=0;e<15;e++){r=!n&&1==(u>>e&1);e<8?this.modules[8][this.moduleCount-15+e]=r:e<9?this.modules[8][e-8]=r:this.modules[8][e-8+1]=r}this.modules[8][this.moduleCount-8]=!n},mapData:function(n,t){for(var e=0,r=this.moduleCount-1,o=this.moduleCount-1;o>0)o-=2)for(6==o&&o--;;){for(var i=0;i<2;i++)if(null==this.modules[r][o-i]){var u=!1;e<n.length&&(u=1==(n[e]>>>7&1),n[e]<<=1),this.modules[r][o-i]=s(r,o-i)?!u:u}if((r+=u?-1:1)<0||this.moduleCount<=r){r-=u?-1:1;break}}}};var i={getLostPoint:function(n){for(var t=n.getModuleCount(),e=0,r=0;r<t;r++)for(var o=0;o<t;o++){for(var i=0,u=n.isDark(r,o),a=-1;a<=1;a++)if(!(r+a<0||t<=r+a))for(var f=-1;f<=1;f++)o+f<0||t<=o+f||0==a&&0==f||u==n.isDark(r+a,o+f)&&i++;i>5&&(e+=3+i-5)}return e}},u=(1<<0)+(0<<3)+(3<<0)+(2<<0);window.QRCode=t}();
  </script>

  <!-- 业务脚本 -->
  <script>
  const tpl = JSON.parse(document.getElementById('TEMPLATE').textContent);
  if (tpl.theme && tpl.theme.brand) document.documentElement.style.setProperty('--brand', tpl.theme.brand);

  const state = {
    idx: 0,
    answers: {},
    items: tpl.Q,
    WT: tpl.WT,
    rules: tpl.rules || { conclusions:[], recommendations:[] },
    lang: tpl.meta?.lang_default || 'zh',
    products: tpl.products || []
  };

  const $ = s => document.querySelector(s);
  const elStep = $('#step'), elBar = $('#bar'), prevBtn = $('#prevBtn'), nextBtn = $('#nextBtn'),
        resultCard = $('#resultCard'), sevEl = $('#severity'), dimBox = $('#dimScores'),
        conclEl = $('#conclusions'), recoEl = $('#reco'), qrEl = $('#qrcode'), qrHint = $('#qrHint');

  function render(){
    const total = state.items.length, idx = state.idx;
    elBar.style.width = (idx/total*100)+'%';
    if (idx >= total){
      document.querySelector('.actions').classList.add('hidden');
      $('#footnote').classList.add('hidden');
      $('#surveyTitle').textContent = '结果';
      elStep.innerHTML = '<div class="muted" style="height:40px">已完成问卷，正在生成结果...</div>';
      return setTimeout(generateResult, 50);
    }
    document.querySelector('.actions').classList.remove('hidden');
    $('#footnote').classList.remove('hidden');
    $('#surveyTitle').textContent = '第 '+(idx+1)+' 题 / 共 '+total+' 题';

    const q = state.items[idx];
    const selected = state.answers[q.key]?.value || null;
    const opts = (q.opts||[]).map((pair,i)=>'<label class="opt"><input type="radio" name="q_'+i+'" value="'+pair[0]+'" '+(selected===pair[0]?'checked':'')+'/> '+pair[1]+'</label>').join('');
    elStep.innerHTML = '<div class="q">'+(q.title?.[state.lang]||q.title?.zh||'')+'</div><div class="opts">'+opts+'</div>';
    elStep.querySelectorAll('input[type=radio]').forEach(inp=>inp.addEventListener('change', e=>{
      state.answers[q.key] = { value: e.target.value };
    }));

    prevBtn.disabled = idx===0;
    nextBtn.textContent = (idx===total-1) ? (tpl.UI?.[state.lang]?.submit||'生成结果') : (tpl.UI?.[state.lang]?.next||'下一步');
  }

  prevBtn.addEventListener('click', ()=>{ if (state.idx>0){ state.idx--; render(); } });
  nextBtn.addEventListener('click', ()=>{ const q = state.items[state.idx]; if (!state.answers[q.key]){ alert('请先选择本题答案'); return; } state.idx++; render(); });

  function computeScores(answers,WT){
    const scores = Object.fromEntries(Object.keys(WT||{}).map(k=>[k,0]));
    for (const dim of Object.keys(WT||{})){
      const mapping = WT[dim];
      for (const qk of Object.keys(mapping)){
        const ans = answers[qk]; if (!ans) continue;
        const w = mapping[qk][ans.value]; if (typeof w==='number') scores[dim]+=w;
      }
    }
    return scores;
  }
  function severity(scores){
    const total = Object.values(scores).reduce((a,b)=>a+b,0);
    if (total>=10) return 'Ⅲ 建议尽快就医/专科评估';
    if (total>=5) return 'Ⅱ 需要重点关注';
    return 'Ⅰ 正常/轻度建议';
  }
  function mcond(ans,scores,c){
    if (!c) return false;
    if (c.all) return c.all.every(x=>mcond(ans,scores,x));
    if (c.any) return c.any.some(x=>mcond(ans,scores,x));
    if (c.not) return !mcond(ans,scores,c.not);
    if (c.dim){
      for (const k in c.dim){
        const val = Number(scores[k]||0);
        const m = String(c.dim[k]).match(/^([<>]=?|==)s*(-?d+(?:.d+)?)$/);
        if (!m) return false;
        const op = m[1], rhs = Number(m[2]);
        if (op==='>=' && !(val>=rhs)) return false;
        if (op==='>'  && !(val> rhs)) return false;
        if (op==='<=' && !(val<=rhs)) return false;
        if (op==='<'  && !(val< rhs)) return false;
        if (op==='==' && !(val==rhs)) return false;
      }
      return true;
    }
    if (c.q && 'v' in c){
      const a = ans[c.q]; return a && a.value===c.v;
    }
    return false;
  }
  function evaluateRules({answers,scores,rules,lang}){
    const out = { conclusions:[], reco:[] };
    (rules.conclusions||[]).forEach(c=>{ if (mcond(answers,scores,c.if)) out.conclusions.push(c.text?.[lang]||c.text?.zh||''); });
    (rules.recommendations||[]).forEach(r=>{ if (mcond(answers,scores,r.if)) out.reco.push({ code:r.product?.code, title:r.product?.title?.[lang]||r.product?.title?.zh||'' }); });
    return out;
  }
  function generateResult(){
    const scores = computeScores(state.answers, state.WT);
    const sev = severity(scores);
    sevEl.textContent = sev;

    // 生成文字形式的评估结果
    const dimNames = tpl.UI?.[state.lang]?.dim || {};
    const sevNames = tpl.UI?.[state.lang]?.sev || {};
    
    // 评估概述文字
    const totalScore = Object.values(scores).reduce((a,b)=>a+b,0);
    let overview = '';
    if (sev.includes('Ⅲ')) {
      overview = tpl.UI?.[state.lang]?.med || '建议尽快咨询专业医生进行评估。';
    } else if (sev.includes('Ⅱ')) {
      overview = tpl.UI?.[state.lang]?.rec || '建议重点关注上述维度，采取积极措施改善。';
    } else {
      overview = tpl.UI?.[state.lang]?.rec || '总体情况良好，建议继续保持健康生活方式。';
    }

    // 分维度详细评估文字
    const dimDetails = Object.entries(scores).map(([dim,score])=>{
      const name = dimNames[dim] || dim;
      let desc = '';
      if (score >= 5) {
        desc = name + '方面需要重点关注，建议采取积极干预措施。';
      } else if (score >= 2) {
        desc = name + '方面需要保持关注，建议持续监测。';
      } else {
        desc = name + '方面情况良好，请继续保持。';
      }
      return '<div style="margin:12px 0;padding:12px;background:#f8fafc;border-radius:8px"><div style="font-weight:600;margin-bottom:6px">'+name+'</div><div class="muted">'+desc+'</div></div>';
    }).join('');

    dimBox.innerHTML = dimDetails;

    const ev = evaluateRules({answers:state.answers, scores, rules: state.rules, lang: state.lang});
    if (ev.conclusions.length > 0) {
      conclEl.innerHTML = '<h3 style="margin:20px 0 12px">重要提示</h3><ul style="line-height:1.8">'+ev.conclusions.map(x=>'<li style="margin:8px 0">'+x+'</li>').join('')+'</ul><div style="margin-top:16px;padding:12px;background:#fff4e6;border-left:4px solid #ff9800;border-radius:4px"><strong>评估概述：</strong> '+overview+'</div>';
    } else {
      conclEl.innerHTML = '<div style="padding:16px;background:#f0f9ff;border-left:4px solid #2B77F2;border-radius:4px;line-height:1.6"><h3 style="margin:0 0 12px">评估完成</h3><p style="margin:0 0 12px">'+overview+'</p><div style="margin-top:16px" class="muted">如有任何不适或疑问，建议及时咨询专业医疗人员。</div></div>';
    }

    const productMap = Object.fromEntries((state.products||[]).map(p=>[p.id,p]));
    if (ev.reco.length > 0) {
      const recoHTML = ev.reco.map(r=>{
        const p = productMap[r.code]||{};
        const name = r.title || p.name || r.code;
        const desc = p.desc || '专业指导服务，为您提供专业的产后恢复指导。';
        const category = p.category || '';
        const img = (p.images&&p.images[0]) ? '<img src="'+p.images[0]+'" alt="'+name+'" style="width:80px;height:80px;object-fit:cover;border-radius:8px;margin-right:12px" />' : '';
        const priceInfo = p.price && p.price > 0 ? '<div style="margin-top:8px"><span style="color:#2B77F2;font-weight:600;font-size:16px">¥' + p.price + '</span></div>' : '';
        return '<li style="margin:12px 0;padding:16px;border:1px solid #e5e7eb;border-radius:12px;background:#fff;display:flex;align-items:center"><div style="flex-shrink:0">'+img+'</div><div style="flex:1"><div style="font-weight:600;margin-bottom:6px;font-size:16px">'+name+'</div><div class="muted" style="font-size:13px;line-height:1.5;margin-bottom:4px">'+desc+'</div>'+ (category ? '<div style="display:inline-block;padding:2px 8px;background:#f0f9ff;color:#2B77F2;border-radius:4px;font-size:12px;margin-top:4px">'+category+'</div>' : '') + priceInfo + '</div></li>';
      }).join('');
      recoEl.innerHTML = '<h3 style="margin:20px 0 12px;font-size:18px">建议/推荐</h3><div style="margin-bottom:16px;padding:12px;background:#f0f9ff;border-left:4px solid #2B77F2;border-radius:4px;font-size:14px;color:#1e40af">以下产品与服务可能有助于改善您的产后恢复情况，建议根据实际需要在专业指导下使用。</div><ul style="list-style:none;padding:0">'+recoHTML+'</ul>';
    } else {
      recoEl.innerHTML = '<h3 style="margin:20px 0 12px;font-size:18px">建议/推荐</h3><div style="padding:16px;background:#f9fafb;border-radius:8px;text-align:center" class="muted">当前暂无可推荐的产品，建议保持良好的健康习惯，定期复查。</div>';
    }

    const params = new URLSearchParams(location.search);
    const SHOP_QR = params.get('shop_qr') || tpl.shop?.qr || 'https://example.com';
    
    // 简化二维码生成
    qrEl.innerHTML = '<div style="width:128px;height:128px;background:#fff;border:2px solid #333;display:flex;align-items:center;justify-content:center;font-size:12px;color:#999;">扫码访问<br/>'+SHOP_QR.substring(0,20)+'...</div>';
    qrHint.textContent = SHOP_QR;

    resultCard.classList.remove('hidden');
  }

  render();
  </script>

  <!-- 页脚 -->
  <div class="footer">
    小林健康研究所・产后恢复专业评估（Pro）
  </div>
</body>
</html>